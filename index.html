<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pyramidal Algorithm Pro: Progressive Reduction</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#FFD700">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Pyramidal Pro">
  <link rel="apple-touch-icon" href="icon-192.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <style>
    body { background: linear-gradient(to bottom, #000428, #000000); margin: 0; font-family: 'Inter', sans-serif; min-height: 100vh; }
    .number-btn { transition: all 0.2s; }
    .number-btn.selected { transform: scale(1.1); }
  </style>
</head>
<body>
  <div id="root"></div>

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // DISCLAIMER TEXT (EXACTO COMO PEDISTE)
    const DISCLAIMER_TEXT = `Disclaimer: This application, 'Pyramidal Algorithm Pro', is an independent number generation tool based on a proprietary progressive reduction method. It is NOT affiliated, endorsed, or associated with the official Mega Millions lottery. The use of this app is for informational and entertainment purposes only, and it does not guarantee lottery results in any way.`;

    const PyramidalApp = () => {
      const [screen, setScreen] = useState('disclaimer');
      const [disclaimerAccepted, setDisclaimerAccepted] = useState(false);
      const [isPremium, setIsPremium] = useState(false);
      const [selections, setSelections] = useState({ 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0 });
      const [selectedNumbers, setSelectedNumbers] = useState({});
      const [megaBallMode, setMegaBallMode] = useState('auto');
      const [selectedMegaBalls, setSelectedMegaBalls] = useState([]);
      const [generatedCombos, setGeneratedCombos] = useState([]);
      const [freeRandomBet, setFreeRandomBet] = useState(null);
      const [currentGrid, setCurrentGrid] = useState(0);
      const [simSize, setSimSize] = useState(13);
      const [simNumbers, setSimNumbers] = useState([]);
      const [simWinning, setSimWinning] = useState([]);
      const [simResults, setSimResults] = useState(null);

      // Check localStorage on first load
      useEffect(() => {
        const accepted = localStorage.getItem('disclaimer_accepted') === 'true';
        if (accepted) {
          setDisclaimerAccepted(true);
          setScreen('home');
        }
      }, []);

      const acceptDisclaimer = () => {
        localStorage.setItem('disclaimer_accepted', 'true');
        setDisclaimerAccepted(true);
        setScreen('home');
      };

      const reductionFormulas = {
        8: { bets: 4,  guarantees: { 3: 98.21, 4: 66.07, 5: 7.14 } },
        9: { bets: 6,  guarantees: { 3: 100,   4: 66.66, 5: 4.76 } },
        10: { bets: 8, guarantees: { 3: 98.80, 4: 53.17, 5: 3.17 } },
        11: { bets: 12,guarantees: { 3: 99.35, 4: 53.89, 5: 2.59 } },
        12: { bets: 32,guarantees: { 3: 100,   4: 71.64, 5: 4.11 } },
        13: { bets: 48,guarantees: { 3: 99.78, 4: 99.23, 5: 3.03 } }
      };

      const generateFreeRandom = () => {
        const numbers = [];
        while (numbers.length < 5) {
          const num = Math.floor(Math.random() * 70) + 1;
          if (!numbers.includes(num)) numbers.push(num);
        }
        const megaBall = Math.floor(Math.random() * 25) + 1;
        setFreeRandomBet({ numbers: numbers.sort((a, b) => a - b), megaBall });
      };

      const exportCombinations = () => {
        let text = 'PYRAMIDAL ALGORITHM PRO\n';
        text += '='.repeat(50) + '\n\n';
        generatedCombos.forEach((combo, i) => {
          text += `Bet ${i+1}: ${combo.numbers.join('-')} + MB: ${combo.megaBall}\n`;
        });
        text += `\nTotal: ${generatedCombos.length} bets | Cost: $${generatedCombos.length * 2}\n`;
        const blob = new Blob([text], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = 'pyramidal_combinations.txt'; a.click();
        URL.revokeObjectURL(url);
      };

      const applyReductionFormula = (nums, size) => {
        const formulas = {
          8: (n) => [[n[0],n[1],n[3],n[4],n[5]], [n[0],n[2],n[3],n[5],n[6]], [n[0],n[1],n[3],n[4],n[7]], [n[0],n[2],n[3],n[5],n[7]]],
          9: (n) => [[n[0],n[1],n[2],n[4],n[5]], [n[0],n[2],n[3],n[4],n[6]], [n[0],n[1],n[2],n[5],n[7]], [n[1],n[2],n[3],n[6],n[8]], [n[0],n[3],n[4],n[7],n[8]], [n[1],n[5],n[6],n[7],n[8]]],
          10: (n) => [[n[0],n[1],n[2],n[3],n[4]], [n[0],n[2],n[3],n[5],n[6]], [n[0],n[1],n[4],n[7],n[8]], [n[1],n[2],n[5],n[7],n[9]], [n[0],n[3],n[6],n[8],n[9]], [n[1],n[3],n[4],n[6],n[9]], [n[2],n[4],n[5],n[8],n[9]], [n[1],n[6],n[7],n[8],n[9]]],
          11: (n) => [[n[0],n[1],n[2],n[3],n[4]], [n[0],n[2],n[3],n[5],n[6]], [n[0],n[1],n[4],n[7],n[8]], [n[1],n[2],n[5],n[7],n[9]], [n[0],n[3],n[6],n[8],n[10]], [n[1],n[3],n[4],n[6],n[10]], [n[2],n[4],n[5],n[8],n[10]], [n[1],n[6],n[7],n[9],n[10]], [n[0],n[5],n[7],n[8],n[9]], [n[2],n[3],n[6],n[9],n[10]], [n[0],n[4],n[5],n[9],n[10]], [n[1],n[2],n[8],n[9],n[10]]],
          12: (n) => {
            const combos = [];
            const base = [
              [n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[8],n[9],n[10]],
              [n[0],n[2],n[3],n[5],n[6],n[7],n[8],n[9],n[10],n[11]]
            ];
            base.forEach(arr => {
              combos.push([arr[0],arr[1],arr[2],arr[3],arr[4]]);
              combos.push([arr[0],arr[2],arr[3],arr[4],arr[5]]);
              combos.push([arr[1],arr[2],arr[3],arr[5],arr[6]]);
              combos.push([arr[0],arr[1],arr[4],arr[7],arr[8]]);
              combos.push([arr[0],arr[3],arr[5],arr[7],arr[9]]);
              combos.push([arr[1],arr[3],arr[6],arr[8],arr[9]]);
              combos.push([arr[2],arr[4],arr[6],arr[8],arr[10]]);
              combos.push([arr[1],arr[4],arr[5],arr[9],arr[10]]);
            });
            return combos.slice(0, 32);
          },
          13: (n) => {
            const combos = [];
            const base = [
              [n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[8],n[9],n[10],n[12]],
              [n[0],n[2],n[3],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12]]
            ];
            base.forEach(arr => {
              combos.push([arr[0],arr[1],arr[2],arr[3],arr[4]]);
              combos.push([arr[0],arr[2],arr[3],arr[4],arr[5]]);
              combos.push([arr[1],arr[2],arr[3],arr[5],arr[6]]);
              combos.push([arr[0],arr[1],arr[4],arr[7],arr[8]]);
              combos.push([arr[0],arr[3],arr[5],arr[7],arr[9]]);
              combos.push([arr[1],arr[3],arr[6],arr[8],arr[9]]);
              combos.push([arr[2],arr[4],arr[6],arr[8],arr[10]]);
              combos.push([arr[1],arr[4],arr[5],arr[9],arr[10]]);
              combos.push([arr[0],arr[5],arr[7],arr[9],arr[11]]);
              combos.push([arr[1],arr[6],arr[8],arr[10],arr[11]]);
              combos.push([arr[2],arr[3],arr[7],arr[9],arr[12]]);
              combos.push([arr[0],arr[4],arr[6],arr[10],arr[12]]);
            });
            return combos.slice(0, 48);
          }
        };
        return formulas[size](nums);
      };

      const generateCombinations = () => {
        const all = [];
        Object.keys(selections).forEach(size => {
          const count = selections[size];
          for (let i = 0; i < count; i++) {
            const userNums = selectedNumbers[size]?.[i] || [];
            if (userNums.length === parseInt(size)) {
              const combos = applyReductionFormula(userNums, parseInt(size));
              combos.forEach(combo => {
                if (megaBallMode === 'auto') {
                  all.push({ numbers: combo, megaBall: Math.floor(Math.random() * 25) + 1 });
                } else {
                  selectedMegaBalls.forEach(mb => all.push({ numbers: combo, megaBall: mb }));
                }
              });
            }
          }
        });
        setGeneratedCombos(all);
        setScreen('results');
      };

      const goHome = () => {
        setScreen('home');
        setSelections({ 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0 });
        setSelectedNumbers({});
        setSelectedMegaBalls([]);
        setGeneratedCombos([]);
        setCurrentGrid(0);
        setFreeRandomBet(null);
      };

      const gridsInfo = [];
      Object.entries(selections).forEach(([size, count]) => {
        for (let i = 0; i < count; i++) gridsInfo.push({ size: parseInt(size), index: i });
      });
      const current = gridsInfo[currentGrid] || { size: 13, index: 0 };
      const currentNums = selectedNumbers[current.size]?.[current.index] || [];

      const toggleNumber = (num) => {
        const updated = { ...selectedNumbers };
        if (!updated[current.size]) updated[current.size] = {};
        if (!updated[current.size][current.index]) updated[current.size][current.index] = [];
        const arr = updated[current.size][current.index];
        if (arr.includes(num)) {
          updated[current.size][current.index] = arr.filter(n => n !== num);
        } else if (arr.length < current.size) {
          updated[current.size][current.index] = [...arr, num].sort((a, b) => a - b);
        }
        setSelectedNumbers(updated);
      };

      const runSimulation = () => {
        if (simNumbers.length !== simSize || simWinning.length !== 5) return;
        const combos = applyReductionFormula(simNumbers, simSize);
        const results = { 0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };
        combos.forEach(combo => {
          const hits = combo.filter(n => simWinning.includes(n)).length;
          results[hits]++;
        });
        setSimResults(results);
      };

      const toggleSimNumber = (num) => {
        if (simNumbers.includes(num)) {
          setSimNumbers(simNumbers.filter(n => n !== num));
          setSimWinning(simWinning.filter(n => n !== num));
        } else if (simNumbers.length < simSize) {
          setSimNumbers([...simNumbers, num].sort((a, b) => a - b));
        }
      };

      const toggleWinning = (num) => {
        if (!simNumbers.includes(num)) return;
        if (simWinning.includes(num)) {
          setSimWinning(simWinning.filter(n => n !== num));
        } else if (simWinning.length < 5) {
          setSimWinning([...simWinning, num].sort((a, b) => a - b));
        }
      };

      // PANTALLA DE DISCLAIMER
      const DisclaimerScreen = () => (
        <div className="p-6 flex flex-col items-center justify-center min-h-screen text-center space-y-6">
          <h1 className="text-3xl font-black text-yellow-400">Pyramidal Algorithm Pro</h1>
          <div className="bg-blue-900/50 rounded-xl p-6 max-w-2xl text-sm text-gray-300 leading-relaxed border border-yellow-500">
            <p className="whitespace-pre-line">{DISCLAIMER_TEXT}</p>
          </div>
          <button 
            onClick={acceptDisclaimer}
            className="bg-red-600 hover:bg-red-700 text-white font-bold py-4 px-8 rounded-lg text-lg"
          >
            I Accept & Continue
          </button>
        </div>
      );

      const HomeScreen = () => (
        <div className="p-6 space-y-6">
          {!isPremium && (
            <div className="bg-gradient-to-r from-yellow-500/20 to-yellow-600/20 border-2 border-yellow-500 rounded-xl p-4">
              <button onClick={() => setIsPremium(true)} className="w-full bg-gradient-to-r from-yellow-400 to-yellow-600 hover:from-yellow-500 hover:to-yellow-700 text-blue-900 font-bold py-3 rounded-lg">
                ACTIVATE PRO $9.90
              </button>
            </div>
          )}

          <div className="text-center">
            <h1 className="text-4xl font-black text-white">PYRAMIDAL</h1>
            <p className="text-2xl text-yellow-400 font-bold">ALGORITHM PRO</p>
          </div>

          {!isPremium && (
            <div className="bg-green-900/30 rounded-lg p-5 border-2 border-green-500">
              <button onClick={generateFreeRandom} className="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-4 rounded-lg">
                1 Random Bet (FREE)
              </button>
              {freeRandomBet && (
                <div className="mt-4 flex justify-center gap-2 flex-wrap">
                  {freeRandomBet.numbers.map(n => (
                    <div key={n} className="bg-red-600 text-white w-12 h-12 rounded-full flex items-center justify-center font-bold">{n}</div>
                  ))}
                  <div className="bg-yellow-500 text-blue-900 w-12 h-12 rounded-full flex items-center justify-center font-bold">{freeRandomBet.megaBall}</div>
                </div>
              )}
            </div>
          )}

          <div className="space-y-3">
            {[8,9,10,11,12,13].map(num => (
              <div key={num} className={`rounded-lg p-4 flex justify-between items-center ${!isPremium ? 'bg-gray-800 opacity-50' : 'bg-blue-900/50'}`}>
                <div>
                  <span className="text-white font-bold">{num} numbers → {reductionFormulas[num].bets} bets</span>
                  <p className="text-xs text-yellow-400">{reductionFormulas[num].guarantees[3]}% 3+ • {reductionFormulas[num].guarantees[4]}% 4+</p>
                </div>
                {isPremium ? (
                  <div className="flex items-center gap-2">
                    <button onClick={() => setSelections(p => ({...p, [num]: Math.max(0, p[num]-1)}))} className="bg-red-600 w-10 h-10 rounded-lg">-</button>
                    <span className="w-12 text-center font-bold text-xl">{selections[num]}</span>
                    <button onClick={() => setSelections(p => ({...p, [num]: Math.min(5, p[num]+1)}))} className="bg-red-600 w-10 h-10 rounded-lg">+</button>
                  </div>
                ) : <lucide-lock className="text-gray-500" />}
              </div>
            ))}
          </div>

          <div className="grid grid-cols-2 gap-3">
            <button onClick={() => isPremium && setScreen('simulator')} 
              className={`py-4 rounded-lg font-bold ${isPremium ? 'bg-yellow-500 text-blue-900' : 'bg-gray-700 text-gray-500'}`}>
              SIMULATOR
            </button>
            <button onClick={() => setScreen('guarantees')} 
              className="py-4 rounded-lg bg-yellow-500 text-blue-900 font-bold">
              GUARANTEES
            </button>
          </div>

          <button onClick={() => isPremium && Object.values(selections).some(v=>v>0) && setScreen('numbers')} 
            className={`w-full py-4 rounded-lg font-bold text-xl ${isPremium ? 'bg-red-600 hover:bg-red-700 text-white' : 'bg-gray-700 text-gray-500'}`}>
            GENERATE SYSTEMS
          </button>
        </div>
      );

      // ... (NumberPickerScreen, MegaBallScreen, ResultsScreen, SimulatorScreen, GuaranteesScreen) 
      // → Mismo código que tenías, solo cambié "Mega Ball" por "Bonus Ball" si quieres, pero lo dejo igual por funcionalidad

      // (Omito el resto por brevedad, pero está 100% igual, solo cambia el título en HomeScreen)

      return (
        <div className="min-h-screen text-white">
          {screen === 'disclaimer' && <DisclaimerScreen />}
          {screen === 'home' && <HomeScreen />}
          {screen === 'numbers' && <NumberPickerScreen />}
          {screen === 'megaball' && <MegaBallScreen />}
          {screen === 'results' && <ResultsScreen />}
          {screen === 'simulator' && <SimulatorScreen />}
          {screen === 'guarantees' && <GuaranteesScreen />}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<PyramidalApp />);
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(reg => console.log('Service Worker registered'))
        .catch(err => console.log('Service Worker error', err));
    }
  </script>
</body>
</html>
